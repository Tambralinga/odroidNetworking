---
 drivers/infiniband/ulp/sdp/sdp_main.c |   12 ++----------
 1 file changed, 2 insertions(+), 10 deletions(-)

Index: ofed_kernel-2.6.9_U6/drivers/infiniband/ulp/sdp/sdp_main.c
===================================================================
--- ofed_kernel-2.6.9_U6.orig/drivers/infiniband/ulp/sdp/sdp_main.c	2010-08-15 13:32:12.000000000 +0300
+++ ofed_kernel-2.6.9_U6/drivers/infiniband/ulp/sdp/sdp_main.c	2010-08-15 14:12:56.000000000 +0300
@@ -554,7 +554,6 @@
 		return;
 	}
 
-	atomic_dec(sk->sk_prot->orphan_count);
 	ssk->destructed_already = 1;
 
 	down_read(&device_removal_lock);
@@ -2643,7 +2642,6 @@
 
 static atomic_t sockets_allocated;
 static atomic_t memory_allocated;
-static atomic_t orphan_count;
 static int memory_pressure;
 struct proto sdp_proto = {
         .close       = sdp_close,
@@ -2664,13 +2662,11 @@
 	.sockets_allocated = &sockets_allocated,
 	.memory_allocated = &memory_allocated,
 	.memory_pressure = &memory_pressure,
-	.orphan_count = &orphan_count,
         .sysctl_mem             = sysctl_tcp_mem,
         .sysctl_wmem            = sysctl_tcp_wmem,
         .sysctl_rmem            = sysctl_tcp_rmem,
-	.max_header  = sizeof(struct sdp_bsdh),
-        .obj_size    = sizeof(struct sdp_sock),
-	.owner	     = THIS_MODULE,
+	.max_header  		= sizeof(struct sdp_bsdh),
+        .slab_obj_size    	= sizeof(struct sdp_sock),
 	.name	     = "SDP",
 };
 
@@ -2934,10 +2930,6 @@
 	sock_unregister(PF_INET_SDP);
 	proto_unregister(&sdp_proto);
 
-	if (atomic_read(&orphan_count))
-		printk(KERN_WARNING "%s: orphan_count %d\n", __func__,
-		       atomic_read(&orphan_count));
-
 	destroy_workqueue(rx_comp_wq);
 	destroy_workqueue(sdp_wq);
 
Index: ofed_kernel-2.6.9_U6/drivers/infiniband/ulp/sdp/sdp.h
===================================================================
--- ofed_kernel-2.6.9_U6.orig/drivers/infiniband/ulp/sdp/sdp.h	2010-08-15 13:32:11.000000000 +0300
+++ ofed_kernel-2.6.9_U6/drivers/infiniband/ulp/sdp/sdp.h	2010-08-15 14:11:24.000000000 +0300
@@ -122,7 +122,6 @@
 		sdp_dbg(sk, "%s:%d - sock_put(" SOCK_REF_ALIVE \
 			") - refcount = %d from withing sk_common_release\n",\
 			__func__, __LINE__, atomic_read(&(sk)->sk_refcnt));\
-		atomic_inc((sk)->sk_prot->orphan_count);\
 		sk_common_release(sk); \
 } while (0)
 
